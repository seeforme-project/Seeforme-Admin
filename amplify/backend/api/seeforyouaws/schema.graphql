type AvailabilitySlot {
  day: String!
  startTime: AWSTime!
  endTime: AWSTime!
}


type Volunteer @model @auth(rules: [
  # This is the modern, cleaner way to write the owner rule.
  # It explicitly says the owner is identified by the "owner" field,
  # and that owner can create, read, and update their own records.
  { allow: owner, operations: [create, read, update] }
  { allow: public, operations: [read] }
  { allow: groups, groups: ["Admins"], operations: [create, read, update, delete] }
]) {
  id: ID!
  # We add the "owner" field and link it to the id field.
  # @auth directives will automatically populate this.
  owner: ID @index(name: "byOwner", sortKeyFields: ["id"])

  name: String!
  email: String!
  gender: String!

  isAvailableNow: Boolean
  availabilitySchedule: [AvailabilitySlot]

  warningCount: Int
  isBanned: Boolean
}


type Call @model @auth(rules: [
  { allow: public, provider: apiKey, operations: [create, read, update] }  # Allow anyone to create calls
  { allow: private, operations: [read, update, delete] }  # Authenticated users can manage
]) {
  id: ID!
  blindUserId: ID!
  blindUserName: String!
  volunteerId: ID
  volunteerName: String
  status: CallStatus!
  meetingId: String!
  createdAt: AWSDateTime
  updatedAt: AWSDateTime
}

enum CallStatus {
  PENDING
  ACCEPTED
  REJECTED
  COMPLETED
  CANCELLED
}

type Report @model @auth(rules: [
  # Volunteers/Blind users can create reports
  { allow: public, provider: apiKey, operations: [create] },
  { allow: private, operations: [create] },
  # Admins can read and update them
  { allow: groups, groups: ["Admins"], operations: [create, read, update, delete] }
]) {
  id: ID!
  callId: ID! # Links report to the specific video call
  reportedBy: String! # "BLIND" or "VOLUNTEER"
  category: ReportCategory!
  description: String # Optional description
  status: ReportStatus!
  createdAt: AWSDateTime
}

enum ReportCategory {
  GOOD_EXPERIENCE      # For positive feedback
  CONNECTION_ISSUES    # Technical problems
  INAPPROPRIATE_BEHAVIOR # Critical (Nudity/Harassment)
  SAFETY_CONCERN       # Critical (Bad advice)
  OTHER
}

enum ReportStatus {
  OPEN
  RESOLVED
}

type BlindUser @model @auth(rules: [
  # Allow public (Guest) to create/read/update their own record via API Key
  { allow: public, provider: apiKey, operations: [create, read, update] }
  # Allow admins to manage
  { allow: groups, groups: ["Admins"], operations: [read, delete, update] }
]) {
  id: ID! @primaryKey # This will be the Device UUID
  trustedVolunteerIds: [String] # A list of IDs of volunteers they trust

  isBanned: Boolean
  adminWarningMessage: String # If not null, read this out loud

}

type Notification @model @auth(rules: [
  # Admin creates them, User (Volunteer) reads them
  { allow: groups, groups: ["Admins"], operations: [create, read, update, delete] },
  { allow: owner, ownerField: "userId", operations: [read, update] }
]) {
  id: ID!
  userId: ID! @index(name: "byUser") # The Volunteer's ID
  title: String!   # e.g., "Conduct Warning"
  message: String! # e.g., "We received a report about..."
  type: NotificationType!
  isRead: Boolean  # To show red dot
  createdAt: AWSDateTime
}

enum NotificationType {
  WARNING
  INFO
  BAN_NOTICE
}